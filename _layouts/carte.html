---
layout: null
title: Carte complète
---

<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>{{ page.title }}</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; }
    canvas { border: 1px solid #333; image-rendering: pixelated; }
  </style>
</head>
<body>
  <h1>{{ page.title }}</h1>
  <canvas id="full-map"></canvas>
  <p>Chaque pixel représente un niveau</p>

  <script src="https://cdn.jsdelivr.net/npm/js-yaml@4/dist/js-yaml.min.js"></script>
<script>
const BASE_URL = "{{ site.baseurl }}";

const minX = -50, maxX = 50;
const minY = -50, maxY = 50;
const z = 0;

const canvas = document.getElementById("full-map");
const width = maxX - minX + 1;
const height = maxY - minY + 1;
canvas.width = width;
canvas.height = height;
const ctx = canvas.getContext("2d");

function getBiomeColor(type) {
  switch(type) {
    case "ville": return "#888888";
    case "foret": return "#008000";
    case "eau": return "#0000ff";
    case "plaine": return "#a0d080";
    case "montagne": return "#aaaaaa";
    case "desert": return "#edc9af";
    case "route": return "#b5651d";
    default: return "#333333"; // inconnu
  }
}

async function loadYAMLLevel(x, y, z) {
  const levelId = `level_${x}_${y}_${z}`;
  const url = `${BASE_URL}/assets/levels/x_${x}/${levelId}.yml`;
  try {
    const res = await fetch(url);
    if (!res.ok) return null;
    const text = await res.text();
    return jsyaml.load(text);
  } catch {
    return null;
  }
}

async function drawFullMap() {
  const tasks = [];

  for (let x = minX; x <= maxX; x++) {
    for (let y = minY; y <= maxY; y++) {
      tasks.push({x,y});
    }
  }

  // Traite les fetchs par paquets (50 à la fois)
  const batchSize = 50;
  for (let i = 0; i < tasks.length; i += batchSize) {
    const batch = tasks.slice(i, i+batchSize).map(async ({x,y}) => {
      const level = await loadYAMLLevel(x,y,z);
      const color = level && level.type ? getBiomeColor(level.type) : "#333";
      ctx.fillStyle = color;
      ctx.fillRect(x - minX, y - minY, 1, 1);
    });
    await Promise.all(batch); // attend la fin du lot avant de continuer
  }

  console.log("Carte complète générée !");
}

drawFullMap();
</script
</body>
</html>
